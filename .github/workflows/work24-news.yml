name: Work24 Job Bot (Hybrid)

on:
  schedule:
    # 매일 오전 11시 (KST) = 01시 (UTC)
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  send-work24-jobs:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # Chrome 설정 (Selenium 폴백용 - 실패해도 계속 진행)
    - name: Setup Chrome
      uses: browser-actions/setup-chrome@latest
      with:
        chrome-version: stable
      continue-on-error: true
    
    - name: Install ChromeDriver
      run: |
        CHROME_VERSION=$(google-chrome --version 2>/dev/null | awk '{print $3}' | cut -d '.' -f 1) || echo "120"
        wget -q https://chromedriver.storage.googleapis.com/LATEST_RELEASE_${CHROME_VERSION} -O /tmp/chromedriver_version || echo "120.0.6099.109" > /tmp/chromedriver_version
        CHROMEDRIVER_VERSION=$(cat /tmp/chromedriver_version)
        wget -q https://chromedriver.storage.googleapis.com/${CHROMEDRIVER_VERSION}/chromedriver_linux64.zip || true
        unzip -q chromedriver_linux64.zip 2>/dev/null || true
        sudo mv chromedriver /usr/local/bin/ 2>/dev/null || true
        sudo chmod +x /usr/local/bin/chromedriver 2>/dev/null || true
      continue-on-error: true
    
    - name: Install dependencies
      run: |
        cd work24_bot
        pip install --quiet -r requirements.txt
    
    - name: Run work24 hybrid bot
      env:
        KAKAO_REST_API_KEY: ${{ secrets.KAKAO_REST_API_KEY }}
        KAKAO_REFRESH_TOKEN: ${{ secrets.KAKAO_REFRESH_TOKEN }}
      run: |
        cd work24_bot
        python daily_work24_hybrid.py
